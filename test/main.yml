# http://www.jeffgeerling.com/blog/testing-ansible-roles-travis-ci-github
---

- hosts: localhost
  roles:
    - pauvos.docker-engine
  become: true
  become_user: root
  tasks: 
    - name: install docker-py
      pip: name=docker-py
    - name: install sshpass
      package: name=sshpass state=latest

- name: Bring up docker containers
  hosts: all
  become: true
  become_user: root
  vars:
    inventory:
      - name: install_burp2
        image: "chrismeyers/ubuntu12.04"
  roles:
    - { role: provision_docker,
      provision_docker_inventory: "{{inventory}}",
      provision_docker_stop_timeout: "1200",
      provision_docker_state: "started",
      provision_docker_tty: "true"}
  tasks:
    - name: Group primary
      add_host:
        hostname: "{{item}}"
        groups: primary
      with_items:
        - install_burp2
      tags: provision_docker

- name: Test Install burp2_server
  hosts: primary
  pre_tasks:
    - name: "Build hosts file"
      #lineinfile: dest=/etc/hosts regexp='.*{{inventory_hostname}}$' line="{{ hostvars[inventory_hostname].ansible_default_ipv4.address }} {{inventory_hostname}}" state=present
      shell: 'echo "{{ hostvars[inventory_hostname].ansible_default_ipv4.address }} {{inventory_hostname}}" >> /etc/hosts'
      when: hostvars[inventory_hostname].ansible_default_ipv4.address is defined
    - debug: "msg=Running on host {{inventory_hostname}}, {{hostvars[inventory_hostname]['ansible_ssh_host']}}"
  roles:
    - { role: ansible_burp2_server, tags: [ "burp2_server"] }
