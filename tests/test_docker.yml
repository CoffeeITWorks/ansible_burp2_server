# http://www.jeffgeerling.com/blog/testing-ansible-roles-travis-ci-github

---
- hosts: localhost
  roles:
    - pauvos.docker-engine
  tasks: 
    - name: install docker-py
      pip: name=docker-py

- name: Bring up docker containers
  hosts: all
  vars:
    inventory:
      - name: install_burp2
        image: ubuntu-upstart:14.04
  roles:
    - { role: chrismeyersfsu.provision_docker,
      provision_docker_inventory: "{{inventory}}",
      provision_docker_company: 'ansible' }
  tasks:
    - name: Group primary
      add_host:
        hostname: "{{item}}"
        groups: primary
      with_items:
        - install_burp2
      tags: provision_docker

- name: Test Install burp2_server
  hosts: primary:secondary
  user: root
  pre_tasks:
     - name: "Build hosts file"
       #lineinfile: dest=/etc/hosts regexp='.*{{inventory_hostname}}$' line="{{ hostvars[inventory_hostname].ansible_default_ipv4.address }} {{inventory_hostname}}" state=present
       shell: 'echo "{{ hostvars[inventory_hostname].ansible_default_ipv4.address }} {{inventory_hostname}}" >> /etc/hosts'
       when: hostvars[inventory_hostname].ansible_default_ipv4.address is defined

     - debug: msg="Running on host {{inventory_hostname}}, {{hostvars[inventory_hostname]['ansible_ssh_host']}}"

  roles:
     - { role: ansible_burp2_server
        , tags: burp2_server }
